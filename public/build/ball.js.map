{"version":3,"sources":["../../src/ball_raw.js"],"names":["phonon","options","navigator","defaultPage","animatePages","enableBrowserBackButton","templateRootDirectory","i18n","app","document","on","evt","socket","msg","alert","updateBallOwnerText","checkOwner","close","page","preventClose","content","activity","onReady","ownerToken","localStorage","getItem","fetch","method","headers","body","JSON","stringify","pass","then","blob","json","data","console","log","classList","add","isBallOwner","remove","removeItem","name","$","innerHTML","readyDelay","action","onCreate","addEventListener","ballName","value","nowTime","Date","ballCode","getTime","request","Request","getBall","ownerId","ballpos","lat","lng","res","window","location","emit","setItem","onClose","self","io","marker","currentpos","_id","ballOwner","owner","loc","lon","ballAppInit","grabLoc","createMaps","callback","geolocation","getCurrentPosition","position","coords","latitude","longitude","e","setTimeout","map","google","maps","Map","getElementById","zoom","center","styles","disableDefaultUI","gmarkers","removeMarkers","i","length","setMap","watchOptions","enableHighAccuracy","timeout","maximumAge","watch","watchPosition","setCenter","ballDistance","distance","showMarker","err","addListener","event","showBall","ballMarker","Marker","icon","title","push","pos","closeCheck","z","getZoom","windowContent","numberWithCommas","infowindow","InfoWindow","iwOuter","parentNode","childNodes","open","selector","querySelector","$$","querySelectorAll","lon1","lat1","lon2","lat2","R","dLat","toRad","dLon","a","Math","sin","cos","c","atan2","sqrt","d","round","x","toString","replace","Number","prototype","PI","start"],"mappings":"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","file":"ball.js","sourcesContent":["// phonon initiate\nphonon.options({\n    navigator: {\n        defaultPage: 'home',\n        animatePages: true,\n        enableBrowserBackButton: true,\n        templateRootDirectory: './tpl'\n    },\n    i18n: null // for this example, we do not use internationalization\n});\n\nvar app = phonon.navigator();\n\n// global event works\ndocument.on('pagecreated', function(evt) {\n  socket.on('ball change', function(msg){\n    var alert = phonon.alert('New ball owner is ' + msg + '!', 'The ball has changed hands', true, 'ok');\n    alert.on('confirm', function() {\n      updateBallOwnerText(msg);\n      checkOwner();\n    });\n    alert.close();\n  });\n\n});\n/**\n * The activity scope is not mandatory.\n * For the home page, we do not need to perform actions during\n * page events such as onCreate, onReady, etc\n*/\napp.on({page: 'home', preventClose: false, content: null}, function(activity) {\n\n    activity.onReady(function() {\n      checkOwner();\n    });\n\n});\n\nfunction checkOwner(){\n    const ownerToken = localStorage.getItem('ballOwner');\n\n    if(ownerToken){\n        fetch('/api/checkowner', {\n        method: 'POST',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({pass: ownerToken})\n        })\n        .then(blob => blob.json())\n        .then(function(data){\n            console.log('pass match: ' + data);\n            if(data){\n                document.body.classList.add('ball-owner');\n                isBallOwner = true;  \n            }\n            else {\n                document.body.classList.remove('ball-owner');\n                localStorage.removeItem('ballOwner');\n                isBallOwner = false;\n            }\n        });\n    }\n};\n\nfunction updateBallOwnerText(name){\n    $('#ballInfo .owner').innerHTML = name + ' has the ball';\n}\n  app.on({page: 'getball', preventClose: true, content: 'getball.html', readyDelay: 1}, function(activity) {\n\n      var action = null;\n\n      activity.onCreate(function() {\n        $('#ballName').classList.remove('err');\n\n        $('#ballName').addEventListener('click', function(){\n          $('#ballName').classList.remove('err');\n        });\n\n        // var passBlocks = document.querySelectorAll('#passBlock div');\n        // passBlocks.forEach(function(block) {\n        //   block.addEventListener('click', function(){\n        //     var currentVal = parseInt(this.dataset.val);\n        //     var currentIndex = parseInt(this.dataset.num);\n        //     switch(currentVal){\n        //       case 0:\n        //         this.dataset.val = 1;\n        //         this.classList.add('one');\n        //         break;\n        //       case 1:\n        //         this.dataset.val = 2;\n        //         this.classList.add('two');\n        //         break;\n        //       case 2:\n        //         this.dataset.val = 3;\n        //         this.classList.add('three');\n        //         break;\n        //       case 3:\n        //         this.dataset.val = 0;\n        //         this.className = '';\n        //         this.classList.add('zero');\n        //         break;\n        //     };\n        //     var ballCode = $('#ballCode').value;\n        //     var newCode = Array.from(ballCode);\n        //     newCode[currentIndex + 3] = (currentVal + 1);\n        //     var resultCode = newCode.join(\"\");\n        //     $('#ballCode').value = resultCode;\n        //   });\n        // });\n\n        $('#grabBall').addEventListener('click', function(){\n          var ballName = $('#ballName').value;\n          var nowTime = new Date();\n          var ballCode = nowTime.getTime();\n\n          if(!ballName){\n            $('#ballName').classList.add('err');\n            return;\n          }\n\n          var request = new Request(getBall + '/' + ownerId + '/' + ballName + '/' + ballpos.lat + '/' + ballpos.lng + '/' + ballCode, {\n            method: 'POST',\n          });\n\n          // Now use it!\n          fetch(request).then(function(res) {\n            window.location = '#!home';\n            socket.emit('ball change', ballName);\n            localStorage.setItem('ballOwner', ballCode);     \n          });\n   \n        });\n\n    });\n\n    activity.onClose(function(self) {\n        self.close();\n    });\n\n  }); // get ball page\n/*jshint esnext: true */\n/*jslint node: true */\n/* jshint browser: true */\n    \"use strict\";\n\n// global vars\nvar socket = io();\nvar ballpos;\nvar ownerId;\nvar getBall = '/api/getball';\nvar isBallOwner = false;\nvar marker;\nvar currentpos = {};\n\n// get current ball location/owner\n(function(){\n  fetch(getBall)\n  .then(blob => blob.json())\n  .then(function(data){\n    ownerId = data._id;\n    var ballOwner = data.owner;\n    updateBallOwnerText(ballOwner);\n    ballpos = {\n      lat: data.loc.lat, \n      lng: data.loc.lon\n    };\n   console.log(data);\n  });\n})();\n\n\nfunction ballAppInit(){\n  grabLoc(createMaps);\n};\n\nvar grabLoc = function(callback){\n  if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(function(position) {\n      currentpos = {\n        lat: position.coords.latitude,\n        lng: position.coords.longitude\n      };\n      callback();\n      // infoWindow.setPosition(pos);\n      // infoWindow.setContent('Location found.');\n      // infoWindow.open(map);\n      // map.setCenter(pos);\n    }, function(e) {\n      console.log(e);\n      alert(e);\n      setTimeout(()=>{\n          grabLoc(createMaps);\n        }, 5000);\n    });\n  } else {\n    // Browser doesn't support Geolocation\n    alert('you wont allow geo, loser!');\n  }\n}\n\nfunction createMaps(){\n\n// create map and events\n        var map = new google.maps.Map(document.getElementById('map'), {\n          zoom: 15,\n          center: currentpos,\n          styles: [{\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#1d2c4d\"}]},{\"elementType\":\"labels.text.fill\",\"stylers\":[{\"color\":\"#8ec3b9\"}]},{\"elementType\":\"labels.text.stroke\",\"stylers\":[{\"color\":\"#1a3646\"}]},{\"featureType\":\"administrative.country\",\"elementType\":\"geometry.stroke\",\"stylers\":[{\"color\":\"#4b6878\"}]},{\"featureType\":\"administrative.land_parcel\",\"elementType\":\"labels.text.fill\",\"stylers\":[{\"color\":\"#64779e\"}]},{\"featureType\":\"administrative.province\",\"elementType\":\"geometry.stroke\",\"stylers\":[{\"color\":\"#4b6878\"}]},{\"featureType\":\"landscape.man_made\",\"elementType\":\"geometry.stroke\",\"stylers\":[{\"color\":\"#334e87\"}]},{\"featureType\":\"landscape.natural\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#023e58\"}]},{\"featureType\":\"poi\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#283d6a\"}]},{\"featureType\":\"poi\",\"elementType\":\"labels.text.fill\",\"stylers\":[{\"color\":\"#6f9ba5\"}]},{\"featureType\":\"poi\",\"elementType\":\"labels.text.stroke\",\"stylers\":[{\"color\":\"#1d2c4d\"}]},{\"featureType\":\"poi.business\",\"stylers\":[{\"visibility\":\"off\"}]},{\"featureType\":\"poi.park\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#023e58\"}]},{\"featureType\":\"poi.park\",\"elementType\":\"labels.text\",\"stylers\":[{\"visibility\":\"off\"}]},{\"featureType\":\"poi.park\",\"elementType\":\"labels.text.fill\",\"stylers\":[{\"color\":\"#3C7680\"}]},{\"featureType\":\"road\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#304a7d\"}]},{\"featureType\":\"road\",\"elementType\":\"labels.text.fill\",\"stylers\":[{\"color\":\"#98a5be\"}]},{\"featureType\":\"road\",\"elementType\":\"labels.text.stroke\",\"stylers\":[{\"color\":\"#1d2c4d\"}]},{\"featureType\":\"road.highway\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#2c6675\"}]},{\"featureType\":\"road.highway\",\"elementType\":\"geometry.stroke\",\"stylers\":[{\"color\":\"#255763\"}]},{\"featureType\":\"road.highway\",\"elementType\":\"labels.text.fill\",\"stylers\":[{\"color\":\"#b0d5ce\"}]},{\"featureType\":\"road.highway\",\"elementType\":\"labels.text.stroke\",\"stylers\":[{\"color\":\"#023e58\"}]},{\"featureType\":\"transit\",\"elementType\":\"labels.text.fill\",\"stylers\":[{\"color\":\"#98a5be\"}]},{\"featureType\":\"transit\",\"elementType\":\"labels.text.stroke\",\"stylers\":[{\"color\":\"#1d2c4d\"}]},{\"featureType\":\"transit.line\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#283d6a\"}]},{\"featureType\":\"transit.station\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#3a4762\"}]},{\"featureType\":\"water\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#0e1626\"}]},{\"featureType\":\"water\",\"elementType\":\"labels.text.fill\",\"stylers\":[{\"color\":\"#4e6d70\"}]}],\n          disableDefaultUI: true\n        });\n        var gmarkers = [];\n        var removeMarkers = function(){\n            for(var i=0; i<gmarkers.length; i++){\n                gmarkers[i].setMap(null);\n            }\n        };\n\n        var watchOptions = {\n          enableHighAccuracy: false,\n          timeout: 10000,\n          maximumAge: 100\n        };\n\n        var watch = navigator.geolocation.watchPosition(function(position){\n          console.log(position);\n          currentpos = {\n            lat: position.coords.latitude,\n            lng: position.coords.longitude\n          };\n          map.setCenter(currentpos);\n          var ballDistance = distance(currentpos.lng, currentpos.lat, ballpos.lng, ballpos.lat);\n          showMarker(currentpos, ballDistance);\n        }, \n        (err)=>{\n          console.log(err);\n        }, watchOptions);\n\n        map.addListener('click', function(event) {\n          grabLoc(()=>{\n            if(isBallOwner){\n              showMarker(currentpos, 0);\n              return;\n            }\n            var ballDistance = distance(currentpos.lng, currentpos.lat, ballpos.lng, ballpos.lat);\n            showMarker(currentpos , ballDistance);\n          });\n        });\n\n        // map.addListener('dragend', function(event){\n        //   lookForBall();\n        // });\n        // map.addListener('zoom_changed', function(event){\n        //   lookForBall();\n        // });\n\n      var showBall = function() {\n        console.log('look for ball');\n        // console.log('close enough');\n        var ballMarker = new google.maps.Marker({\n          position: {lat: ballpos.lat, lng: ballpos.lng},\n          map: map,\n          icon: 'ball.png',\n          title: 'Uluru (Ayers Rock)'\n        });\n        gmarkers.push(ballMarker);\n        ballMarker.addListener('click', function(event) {\n          if(!isBallOwner){\n            console.log('take ball');\n            window.location = '#!getball';\n          }\n        });     \n      };  // look for ball\n\n      var showMarker = function(pos, distance){\n          var closeCheck = distance < 100;\n          var z = map.getZoom();\n          console.log(distance, closeCheck);\n          removeMarkers();\n          if(z >= 15 && closeCheck){\n            showBall();\n          }\n\n          marker = new google.maps.Marker({\n            position: isBallOwner ? {lat: ballpos.lat, lng: ballpos.lng} : pos,\n            map: map,\n            icon: isBallOwner ? 'ball.png' : 'dot.png',\n            title: 'dot'\n          });\n          gmarkers.push(marker);\n\n          var windowContent;\n          if(!isBallOwner){\n            windowContent = 'You are <span>' + numberWithCommas(distance) + 'M</span> from the ball';\n          }\n          else {\n            windowContent = 'Last bounced here';\n          }\n          var infowindow = new google.maps.InfoWindow({\n            content: windowContent\n          });\n\n          google.maps.event.addListener(infowindow, 'domready', function() {\n             var iwOuter = $('.gm-style-iw');\n             iwOuter.parentNode.childNodes[0].childNodes[3].classList.add('style-window');\n             iwOuter.parentNode.childNodes[0].childNodes[2].childNodes[0].childNodes[0].classList.add('style-window');\n             iwOuter.parentNode.childNodes[0].childNodes[2].childNodes[1].childNodes[0].classList.add('style-window');\n          });\n          \n          infowindow.open(map, marker);\n      };\n\n};// init map\n\n  // mimick jquery\n  function $(selector) { return document.querySelector(selector);  }\n  function $$(selector) { return document.querySelectorAll(selector); }\n  \n  // calc distance from ball\n  function distance(lon1, lat1, lon2, lat2) {\n    var R = 6371; // Radius of the earth in km\n    var dLat = (lat2-lat1).toRad();  // Javascript functions in radians\n    var dLon = (lon2-lon1).toRad(); \n    var a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n            Math.cos(lat1.toRad()) * Math.cos(lat2.toRad()) * \n            Math.sin(dLon/2) * Math.sin(dLon/2); \n    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); \n    var d = R * c * 1000; // Distance in km\n    return Math.round(d);\n  }\n\n  function numberWithCommas(x) {\n      return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n  }\n\n  /** Converts numeric degrees to radians */\n  if (typeof(Number.prototype.toRad) === \"undefined\") {\n    Number.prototype.toRad = function() {\n      return this * Math.PI / 180;\n    };\n  }\n\n  // Let's go!\napp.start();\n"]}