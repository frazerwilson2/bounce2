{"version":3,"sources":["../../src/ball_raw.js"],"names":["phonon","options","navigator","defaultPage","animatePages","enableBrowserBackButton","templateRootDirectory","i18n","app","document","on","evt","socket","msg","console","log","alert","updateBallOwnerText","open","page","preventClose","content","activity","onReady","checkOwner","ownerToken","localStorage","getItem","fetch","method","headers","body","JSON","stringify","pass","then","blob","json","data","classList","add","remove","name","$","innerHTML","readyDelay","action","onCreate","addEventListener","passBlocks","querySelectorAll","forEach","block","currentVal","parseInt","dataset","val","currentIndex","num","className","ballCode","value","newCode","Array","from","resultCode","join","ballName","request","Request","getBall","ownerId","ballpos","lat","lng","res","emit","window","location","setItem","onClose","self","close","io","_id","ballOwner","owner","loc","lon","ballAppInit","uluru","map","google","maps","Map","getElementById","zoom","center","styles","disableDefaultUI","gmarkers","removeMarkers","i","length","setMap","lookForBall","addListener","event","pos","latLng","ballDistance","distance","marker","Marker","position","icon","title","push","infowindow","InfoWindow","numberWithCommas","iwOuter","parentNode","childNodes","z","getZoom","cLat","getCenter","cLon","closeness","ballMarker","selector","querySelector","$$","lon1","lat1","lon2","lat2","R","dLat","toRad","dLon","a","Math","sin","cos","c","atan2","sqrt","d","clear","round","x","toString","replace","Number","prototype","PI","start"],"mappings":"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","file":"ball.js","sourcesContent":["// phonon initiate\nphonon.options({\n    navigator: {\n        defaultPage: 'home',\n        animatePages: true,\n        enableBrowserBackButton: true,\n        templateRootDirectory: './tpl'\n    },\n    i18n: null // for this example, we do not use internationalization\n});\n\nvar app = phonon.navigator();\n\n// global event works\ndocument.on('pagecreated', function(evt) {\n  socket.on('ball change', function(msg){\n    console.log(msg);\n    var alert = phonon.alert('New ball owner is ' + msg + '!', 'The ball has changed hands', true, 'ok');\n    alert.on('confirm', function() {\n      updateBallOwnerText(msg);\n    });\n    alert.open();\n  });\n\n});\n/**\n * The activity scope is not mandatory.\n * For the home page, we do not need to perform actions during\n * page events such as onCreate, onReady, etc\n*/\napp.on({page: 'home', preventClose: false, content: null}, function(activity) {\n\n    activity.onReady(function() {\n      checkOwner();\n    });\n\n});\n\nfunction checkOwner(){\n    const ownerToken = localStorage.getItem('ballOwner');\n\n    if(ownerToken){\n        fetch('/api/checkowner', {\n        method: 'POST',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({pass: ownerToken})\n        })\n        .then(blob => blob.json())\n        .then(function(data){\n            console.log('pass match: ' + data);\n            if(data){\n                document.body.classList.add('ball-owner')    \n            }\n            else {\n                document.body.classList.remove('ball-owner');\n            }\n        });\n    }\n};\n\nfunction updateBallOwnerText(name){\n    $('#ballInfo .owner').innerHTML = name + ' has the ball';\n}\n  app.on({page: 'getball', preventClose: true, content: 'getball.html', readyDelay: 1}, function(activity) {\n\n      var action = null;\n\n      activity.onCreate(function() {\n        $('#ballName').classList.remove('err');\n\n        $('#ballName').addEventListener('click', function(){\n          $('#ballName').classList.remove('err');\n        });\n\n        var passBlocks = document.querySelectorAll('#passBlock div');\n        passBlocks.forEach(function(block) {\n          block.addEventListener('click', function(){\n            var currentVal = parseInt(this.dataset.val);\n            var currentIndex = parseInt(this.dataset.num);\n            switch(currentVal){\n              case 0:\n                this.dataset.val = 1;\n                this.classList.add('one');\n                break;\n              case 1:\n                this.dataset.val = 2;\n                this.classList.add('two');\n                break;\n              case 2:\n                this.dataset.val = 3;\n                this.classList.add('three');\n                break;\n              case 3:\n                this.dataset.val = 0;\n                this.className = '';\n                this.classList.add('zero');\n                break;\n            };\n            var ballCode = $('#ballCode').value;\n            var newCode = Array.from(ballCode);\n            newCode[currentIndex + 3] = (currentVal + 1);\n            var resultCode = newCode.join(\"\");\n            $('#ballCode').value = resultCode;\n          });\n        });\n\n        $('#grabBall').addEventListener('click', function(){\n          var ballName = $('#ballName').value;\n          var ballCode = $('#ballCode').value;\n\n          if(!ballName){\n            $('#ballName').classList.add('err');\n            return;\n          }\n\n          var request = new Request(getBall + '/' + ownerId + '/' + ballName + '/' + ballpos.lat + '/' + ballpos.lng + '/' + ballCode, {\n            method: 'POST',\n          });\n\n          // Now use it!\n          fetch(request).then(function(res) { \n            socket.emit('ball change', ballName);\n            window.location = '#!home';\n            localStorage.setItem('ballOwner', ballCode);     \n          });\n   \n        });\n\n    });\n\n    activity.onClose(function(self) {\n        self.close();\n    });\n\n  }); // get ball page\n/*jshint esnext: true */\n/*jslint node: true */\n/* jshint browser: true */\n    \"use strict\";\n\n// global vars\nvar socket = io();\nvar ballpos;\nvar ownerId;\nvar getBall = '/api/getball';\n\n// get current ball location/owner\n(function(){\n  fetch(getBall)\n  .then(blob => blob.json())\n  .then(function(data){\n    ownerId = data._id;\n    var ballOwner = data.owner;\n    updateBallOwnerText(ballOwner);\n    ballpos = {\n      lat: data.loc.lat, \n      lng: data.loc.lon\n    };\n   console.log(data);\n  });\n})();\n\nfunction ballAppInit(){\n\n// create map and events\n        var uluru = {lat: 51.541084, lng: -0.1048659};\n        var map = new google.maps.Map(document.getElementById('map'), {\n          zoom: 15,\n          center: uluru,\n          styles: [\n            {\n              \"elementType\": \"geometry\",\n              \"stylers\": [\n                {\n                  \"color\": \"#1d2c4d\"\n                }\n              ]\n            },\n            {\n              \"elementType\": \"labels.text.fill\",\n              \"stylers\": [\n                {\n                  \"color\": \"#8ec3b9\"\n                }\n              ]\n            },\n            {\n              \"elementType\": \"labels.text.stroke\",\n              \"stylers\": [\n                {\n                  \"color\": \"#1a3646\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"administrative.country\",\n              \"elementType\": \"geometry.stroke\",\n              \"stylers\": [\n                {\n                  \"color\": \"#4b6878\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"administrative.land_parcel\",\n              \"elementType\": \"labels.text.fill\",\n              \"stylers\": [\n                {\n                  \"color\": \"#64779e\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"administrative.province\",\n              \"elementType\": \"geometry.stroke\",\n              \"stylers\": [\n                {\n                  \"color\": \"#4b6878\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"landscape.man_made\",\n              \"elementType\": \"geometry.stroke\",\n              \"stylers\": [\n                {\n                  \"color\": \"#334e87\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"landscape.natural\",\n              \"elementType\": \"geometry\",\n              \"stylers\": [\n                {\n                  \"color\": \"#023e58\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"poi\",\n              \"elementType\": \"geometry\",\n              \"stylers\": [\n                {\n                  \"color\": \"#283d6a\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"poi\",\n              \"elementType\": \"labels.text.fill\",\n              \"stylers\": [\n                {\n                  \"color\": \"#6f9ba5\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"poi\",\n              \"elementType\": \"labels.text.stroke\",\n              \"stylers\": [\n                {\n                  \"color\": \"#1d2c4d\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"poi.business\",\n              \"stylers\": [\n                {\n                  \"visibility\": \"off\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"poi.park\",\n              \"elementType\": \"geometry.fill\",\n              \"stylers\": [\n                {\n                  \"color\": \"#023e58\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"poi.park\",\n              \"elementType\": \"labels.text\",\n              \"stylers\": [\n                {\n                  \"visibility\": \"off\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"poi.park\",\n              \"elementType\": \"labels.text.fill\",\n              \"stylers\": [\n                {\n                  \"color\": \"#3C7680\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"road\",\n              \"elementType\": \"geometry\",\n              \"stylers\": [\n                {\n                  \"color\": \"#304a7d\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"road\",\n              \"elementType\": \"labels.text.fill\",\n              \"stylers\": [\n                {\n                  \"color\": \"#98a5be\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"road\",\n              \"elementType\": \"labels.text.stroke\",\n              \"stylers\": [\n                {\n                  \"color\": \"#1d2c4d\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"road.highway\",\n              \"elementType\": \"geometry\",\n              \"stylers\": [\n                {\n                  \"color\": \"#2c6675\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"road.highway\",\n              \"elementType\": \"geometry.stroke\",\n              \"stylers\": [\n                {\n                  \"color\": \"#255763\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"road.highway\",\n              \"elementType\": \"labels.text.fill\",\n              \"stylers\": [\n                {\n                  \"color\": \"#b0d5ce\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"road.highway\",\n              \"elementType\": \"labels.text.stroke\",\n              \"stylers\": [\n                {\n                  \"color\": \"#023e58\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"transit\",\n              \"elementType\": \"labels.text.fill\",\n              \"stylers\": [\n                {\n                  \"color\": \"#98a5be\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"transit\",\n              \"elementType\": \"labels.text.stroke\",\n              \"stylers\": [\n                {\n                  \"color\": \"#1d2c4d\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"transit.line\",\n              \"elementType\": \"geometry.fill\",\n              \"stylers\": [\n                {\n                  \"color\": \"#283d6a\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"transit.station\",\n              \"elementType\": \"geometry\",\n              \"stylers\": [\n                {\n                  \"color\": \"#3a4762\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"water\",\n              \"elementType\": \"geometry\",\n              \"stylers\": [\n                {\n                  \"color\": \"#0e1626\"\n                }\n              ]\n            },\n            {\n              \"featureType\": \"water\",\n              \"elementType\": \"labels.text.fill\",\n              \"stylers\": [\n                {\n                  \"color\": \"#4e6d70\"\n                }\n              ]\n            }\n          ],\n          disableDefaultUI: true\n        });\n        var gmarkers = [];\n        var removeMarkers = function(){\n            for(var i=0; i<gmarkers.length; i++){\n                gmarkers[i].setMap(null);\n            }\n            lookForBall();\n        };\n        map.addListener('click', function(event) {\n          var pos = {lat: event.latLng.lat(), lng: event.latLng.lng()};\n          console.log(pos);\n          var ballDistance = distance(event.latLng.lng(), event.latLng.lat(), ballpos.lng, ballpos.lat);\n          console.log(ballDistance);\n\n          removeMarkers();\n          var marker = new google.maps.Marker({\n            position: pos,\n            map: map,\n            icon: 'dot.png',\n            title: 'dot'\n          });\n          gmarkers.push(marker);\n          var infowindow = new google.maps.InfoWindow({\n            content: 'You are <span>' + numberWithCommas(ballDistance) + 'M</span> from the ball'\n          });\n\n          google.maps.event.addListener(infowindow, 'domready', function() {\n             // Reference to the DIV which receives the contents of the infowindow using jQuery\n             var iwOuter = $('.gm-style-iw');\n             iwOuter.parentNode.childNodes[0].childNodes[3].classList.add('style-window');\n             iwOuter.parentNode.childNodes[0].childNodes[2].childNodes[0].childNodes[0].classList.add('style-window');\n             iwOuter.parentNode.childNodes[0].childNodes[2].childNodes[1].childNodes[0].classList.add('style-window');\n          });\n          \n          infowindow.open(map, marker);\n          \n        });\n\n        map.addListener('dragend', function(event){\n          lookForBall();\n        });\n        map.addListener('zoom_changed', function(event){\n          lookForBall();\n        });\n      var lookForBall = function() {\n        console.log('look for ball');\n            var z = map.getZoom();\n            var cLat = map.getCenter().lat();\n            var cLon = map.getCenter().lng();\n            var closeness = distance(cLon, cLat, ballpos.lng, ballpos.lat);\n            console.log(closeness);\n            if(z >= 15 && closeness <= 100){\n              console.log('close enough');\n              var ballMarker = new google.maps.Marker({\n                position: {lat: ballpos.lat, lng: ballpos.lng},\n                map: map,\n                icon: 'ball.png',\n                title: 'Uluru (Ayers Rock)'\n              });\n              gmarkers.push(ballMarker);\n              ballMarker.addListener('click', function(event) {\n                console.log('take ball');\n                window.location = '#!getball';\n              });     \n            }\n      };  // look for ball\n\n};// init map\n\n\n      \n\n      // mimick jquery\n      function $(selector) { return document.querySelector(selector);  }\n      function $$(selector) { return document.querySelectorAll(selector); }\n      \n      // calc distance from ball\n      function distance(lon1, lat1, lon2, lat2) {\n        var R = 6371; // Radius of the earth in km\n        var dLat = (lat2-lat1).toRad();  // Javascript functions in radians\n        var dLon = (lon2-lon1).toRad(); \n        var a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n                Math.cos(lat1.toRad()) * Math.cos(lat2.toRad()) * \n                Math.sin(dLon/2) * Math.sin(dLon/2); \n        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); \n        var d = R * c * 1000; // Distance in km\n        console.clear();\n        return Math.round(d);\n      }\n\n      function numberWithCommas(x) {\n          return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n      }\n\n      /** Converts numeric degrees to radians */\n      if (typeof(Number.prototype.toRad) === \"undefined\") {\n        Number.prototype.toRad = function() {\n          return this * Math.PI / 180;\n        };\n      }\n\n  // Let's go!\napp.start();\n\n  //module.exports = ballApp;"]}