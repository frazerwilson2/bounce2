{"version":3,"sources":["../../src/ball_raw.js"],"names":["socket","io","ballpos","ownerId","getBall","getBallFunc","fetch","then","blob","json","data","_id","ballOwner","owner","updateBallOwnerText","lat","loc","lng","lon","console","log","distance","lon1","lat1","lon2","lat2","R","dLat","toRad","dLon","a","Math","sin","cos","c","atan2","sqrt","d","clear","round","numberWithCommas","x","toString","replace","Number","prototype","PI","name","$","innerHTML","initMap","uluru","map","google","maps","Map","document","getElementById","zoom","center","gmarkers","removeMarkers","i","length","setMap","lookForBall","addListener","event","pos","latLng","ballDistance","marker","Marker","position","icon","title","push","infowindow","InfoWindow","content","open","contentString","addClass","z","getZoom","cLat","getCenter","cLon","closeness","ballMarker","window","location","getLocation","navigator","geolocation","getCurrentPosition","showPosition","coords","latitude","longitude","phonon","options","defaultPage","animatePages","enableBrowserBackButton","templateRootDirectory","i18n","app","on","evt","msg","alert","page","preventClose","readyDelay","activity","action","onCreate","addEventListener","ballName","value","ballCode","request","Request","method","res","emit","onClose","self","close","start","selector","querySelector","$$","querySelectorAll","el","cl","classList","add"],"mappings":"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","file":"ball.js","sourcesContent":["\"use strict\";\nvar socket = io();\n\nvar ballpos;\nvar ownerId;\nvar getBall = '/api/getball';\n\nvar getBallFunc = function(){\n  fetch(getBall)\n  .then(blob => blob.json())\n  .then(function(data){\n    ownerId = data._id;\n    var ballOwner = data.owner;\n    updateBallOwnerText(ballOwner);\n    ballpos = {\n      lat: data.loc.lat, \n      lng: data.loc.lon\n    }\n   console.log(data);\n  });\n};\ngetBallFunc();\n\n// calc distance from ball\nfunction distance(lon1, lat1, lon2, lat2) {\n  var R = 6371; // Radius of the earth in km\n  var dLat = (lat2-lat1).toRad();  // Javascript functions in radians\n  var dLon = (lon2-lon1).toRad(); \n  var a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n          Math.cos(lat1.toRad()) * Math.cos(lat2.toRad()) * \n          Math.sin(dLon/2) * Math.sin(dLon/2); \n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); \n  var d = R * c * 1000; // Distance in km\n  console.clear();\n  return Math.round(d);\n}\n\nfunction numberWithCommas(x) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\n/** Converts numeric degrees to radians */\nif (typeof(Number.prototype.toRad) === \"undefined\") {\n  Number.prototype.toRad = function() {\n    return this * Math.PI / 180;\n  }\n}\n\nfunction updateBallOwnerText(name){\n    $('#ballInfo').innerHTML = name + ' has the ball';\n}\n\n\n      function initMap() {\n        var uluru = {lat: 51.541084, lng: -0.1048659};\n        var map = new google.maps.Map(document.getElementById('map'), {\n          zoom: 15,\n          center: uluru\n        });\n        var gmarkers = [];\n        // var marker = new google.maps.Marker({\n        //   position: uluru,\n        //   map: map\n        // });\n        var removeMarkers = function(){\n            for(var i=0; i<gmarkers.length; i++){\n                gmarkers[i].setMap(null);\n            }\n            lookForBall();\n        };\n        map.addListener('click', function(event) {\n          var pos = {lat: event.latLng.lat(), lng: event.latLng.lng()};\n          console.log(pos);\n          var ballDistance = distance(event.latLng.lng(), event.latLng.lat(), ballpos.lng, ballpos.lat);\n          console.log(ballDistance);\n\n          removeMarkers();\n          var marker = new google.maps.Marker({\n            position: pos,\n            map: map,\n            icon: 'rocket.png',\n            title: 'Uluru (Ayers Rock)'\n          });\n          gmarkers.push(marker);\n          var infowindow = new google.maps.InfoWindow({\n            content: 'ball is ' + numberWithCommas(ballDistance) + 'M from here'\n          });\n          \n          infowindow.open(map, marker);\n          \n        });\n        var contentString = '<div id=\"content\">HERE</div>';\n\n      addClass($(\"#map\"), 'working'); //fetch the element with the id ‘someid’\n\n        map.addListener('dragend', function(event){\n          lookForBall();\n        });\n        map.addListener('zoom_changed', function(event){\n          lookForBall();\n        });\n      var lookForBall = function() {\n        console.log('look for ball');\n            var z = map.getZoom();\n            var cLat = map.getCenter().lat();\n            var cLon = map.getCenter().lng();\n            var closeness = distance(cLon, cLat, ballpos.lng, ballpos.lat);\n            console.log(closeness);\n            if(z >= 15 && closeness <= 100){\n              console.log('close enough');\n              var ballMarker = new google.maps.Marker({\n                position: {lat: ballpos.lat, lng: ballpos.lng},\n                map: map,\n                icon: 'ball.png',\n                title: 'Uluru (Ayers Rock)'\n              });\n              gmarkers.push(ballMarker);\n              ballMarker.addListener('click', function(event) {\n                console.log('take ball');\n//                addClass($('body'), 'ball_select');\n                window.location = '#!pagetwo';\n              });     \n            };\n      }\n\n      } // init map\n\n      var x = document.getElementById(\"demo\");\n\n      function getLocation() {\n          if (navigator.geolocation) {\n              navigator.geolocation.getCurrentPosition(showPosition);\n          } else { \n              x.innerHTML = \"Geolocation is not supported by this browser.\";\n          }\n      }\n\n      function showPosition(position) {\n          x.innerHTML = \"Latitude: \" + position.coords.latitude + \n          \"<br>Longitude: \" + position.coords.longitude;\n      }\n\n      getLocation();\n\n      phonon.options({\n          navigator: {\n              defaultPage: 'home',\n              animatePages: true,\n              enableBrowserBackButton: true,\n              templateRootDirectory: './tpl'\n          },\n          i18n: null // for this example, we do not use internationalization\n      });\n\n      var app = phonon.navigator();\n\n\n      // global event works\n      document.on('pagecreated', function(evt) {\n        socket.on('ball change', function(msg){\n          console.log(msg);\n          var alert = phonon.alert(msg + ' has taken the ball!', 'New ball owner', true, 'ok');\n          alert.on('confirm', function() {\n            updateBallOwnerText(msg);\n          });\n          alert.open();\n        });\n      });\n      /**\n       * The activity scope is not mandatory.\n       * For the home page, we do not need to perform actions during\n       * page events such as onCreate, onReady, etc\n      */\n      app.on({page: 'home', preventClose: false, content: null});\n\n\n      app.on({page: 'pagetwo', preventClose: true, content: 'pagetwo.html', readyDelay: 1}, function(activity) {\n\n          var action = null;\n\n          activity.onCreate(function() {\n            $('#grabBall').addEventListener('click', function(){\nvar ballName = $('#ballName').value;\nvar ballCode = $('#ballCode').value;\n\n  var request = new Request(getBall + '/' + ownerId + '/' + ballName + '/' + ballpos.lat + '/' + ballpos.lng, {\n    method: 'POST',\n  });\n\n  // Now use it!\n  fetch(request).then(function(res) { \n    socket.emit('ball change', ballName);\n    window.location = '#!home';     \n  });\n            \n            });\n\n          });\n\n          activity.onClose(function(self) {\n              self.close();\n          });\n\n      });\n\n      // Let's go!\n      app.start();\n\n\n      // mimick jquery\n      function $(selector) { return document.querySelector(selector)  };\n      function $$(selector) { return document.querySelectorAll(selector) };\n      function addClass(el, cl){\n        el.classList.add(cl);\n      };"]}